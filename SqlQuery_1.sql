DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'MigrationsDemo.BlogContext'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201609240156116_InitialCreate'
BEGIN
    CREATE TABLE [dbo].[Blogs] (
        [BlogId] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max),
        CONSTRAINT [PK_dbo.Blogs] PRIMARY KEY ([BlogId])
    )
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201609240156116_InitialCreate', N'MigrationsDemo.BlogContext',  0x1F8B0800000000000400CD57DB6E1B37107D0FD07F20F8D4028EE8CB4B6AAC1238921D08896C236BE79DDA1DC94479D9925C43FAB63EF493FA0B1DEE5DBB962519015A18102C72E6F0CCE15CA87FFEFA3BFAB456923C8375C2E8313D1B9D52023A31A9D0AB31CDFDF2FD07FAE9E32FEFA2EB54ADC98FDAEE22D8A1A77663FAE47D76C9984B9E4071375222B1C699A51F2546319E1A767E7AFA3B3B3B63801014B10889BEE7DA0B05C517FC3A313A81CCE75CCE4D0AD255EBB81317A8E4962B70194F604CE76265B947166E0ACA50722505471631C825255C6BE38BDDCB4707B1B746AFE20C17B87CD86480764B2E1D54DC2F5BF343C3383D0F61B0D6B1864A72E78D3A12F0ECA2D285F5DDDFA42E6D7443E5AE5161BF095117EA8DE967695694F40FBA9C481B8CFAC28E82F909D95E3C6932001325FC9D90492E7D6E61AC21F796CB13729F2FA448BEC2E6C1FC017AAC7329BBBC9019EE6D2DE0D2BD351958BFF90ECB0EDB594A09DBF6657DE7C6B5E757C634D3FEE29C925B24C117129AEBEFC41F7B63E10B68C03821BDE7DE83C5DB9BA550083860D03B2F7CD6A761BE61D95032E7EB6FA057FE0945E56B4A6EC41AD27AA562F0A80556193A799BC3BE431EADFCC96744ACCD8F61D6603D7A2E50928EA8610DD6FE850CC24AAB92C855476D075362C6E03B688E92964059BDA332415F62D9F0691B032B3B43DD41D88E1612CD7996A1609D9652AD90B8EC2793F7F1F1C5A64A0C96B8176AAE61DB9C8429C657D0DBC5A391E98DB0CE4FB9E70B1EAE6C92AA815957FD1DCAD6277505EED758AB776D1DFE2F3D5EA8FDBE7FABDC0D06A3B03A8AB8A0E1507598815BD1C5B9E47647A54E8CCC957EADEA5F4329EBAF8B51AE1C8E50145717A05818FA47AC177F5F603650B8D7BBFAD7F55AA6F74D9AD39B8CEF65765465D9FE093A48BBD2841214E659A421E5E28DF3A046C16014FF29275260BCADC19C6BB104E7CB164F71909DF706F1FF672832E75279C064FCCF669408CAEE9D42831176F858D2CFDC264FDCFEAAF8FAB72ED291A3E7089CE3C6CBB00FEE1F203BE74799CC639A2EF071F85012AC26CE1B47CBB0B022D67DC046537062D54284E7AC8624646C0B5ADBCCF4D2D41263445D46B549EF06E6E0798AC25C592F963CF1B89D8073C52BE00797399A5CAB05A4337D97FB2CF757CE815AC8AD974BC45E3FBF989FDB9CA3BBAC18083F2304A4293004B8D39F7321D386F7CD30957741841CA9EA0359E12B08E1569B06E9D6E803812AF9A690810ED5F5002A9308E6EE74CC9FE12DDCF001F40D563CD9D4FD7137C8FE8BD8963D9A0A8EA359B90AA3F50F3FCA58F855F6F15FBC66A997C70D0000 , N'6.1.3-40302')
END

IF @CurrentMigration < '201609240257122_AddBlogUrl'
BEGIN
    ALTER TABLE [dbo].[Blogs] ADD [Url] [nvarchar](max)
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201609240257122_AddBlogUrl', N'MigrationsDemo.BlogContext',  0x1F8B0800000000000400CD57DB6E1B37107D0FD07F20F8D4028EE8CB4B6AAC1238921D08896C236BE79DDA1DC94479D9925C43FAB63EF493FA0B1DEE5DBB962519015A18102C72E6F0CCE15CA87FFEFA3BFAB456923C8375C2E8313D1B9D52023A31A9D0AB31CDFDF2FD07FAE9E32FEFA2EB54ADC98FDAEE22D8A1A77663FAE47D76C9984B9E4071375222B1C699A51F2546319E1A767E7AFA3B3B3B63801014B10889BEE7DA0B05C517FC3A313A81CCE75CCE4D0AD255EBB81317A8E4962B70194F604CE76265B947166E0ACA50722505471631C825255C6BE38BDDCB4707B1B746AFE20C17B87CD86480764B2E1D54DC2F5BF343C3383D0F61B0D6B1864A72E78D3A12F0ECA2D285F5DDDFA42E6D7443E5AE5161BF095117EA8DE967695694F40FBA9C481B8CFAC28E82F909D95E3C6932001325FC9D90492E7D6E61AC21F796CB13729F2FA448BEC2E6C1FC017AAC7329BBBC9019EE6D2DE0D2BD351958BFF90ECB0EDB594A09DBF6657DE7C6B5E757C634D3FEE29C925B24C117129AEBEFC41F7B63E10B68C03821BDE7DE83C5DB9BA550083860D03B2F7CD6A761BE61D95032E7EB6FA057FE0945E56B4A6EC41AD27AA562F0A80556193A799BC3BE431EADFCC96744ACCD8F61D6603D7A2E50928EA8610DD6FE850CC24AAB92C855476D075362C6E03B688E92964059BDA332415F62D9F0691B032B3B43DD41D88E1612CD7996A1609D9652AD90B8EC2793F7F1F1C5A64A0C96B8176AAE61DB9C8429C657D0DBC5A391E98DB0CE4FB9E70B1EAE6C92AA815957FD1DCAD6277505EED758AB776D1DFE2F3D5EA8FDBE7FABDC0D06A3B03A8AB8A0E1507598815BD1C5B9E47647A54E8CCC957EADEA5F4329EBAF8B51AE1C8E50145717A05818FA47AC177F5F603650B8D7BBFAD7F55AA6F74D9AD39B8CEF65765465D9FE093A48BBD2841214E659A421E5E28DF3A046C16014FF29275260BCADC19C6BB104E7CB164F71909DF706F1FF672832E75279C064FCCF669408CAEE9D42831176F858D2CFDC264FDCFEAAF8FAB72ED291A3E7089CE3C6CBB00FEE1F203BE74799CC639A2EF071F85012AC26CE1B47CBB0B022D67DC046537062D54284E7AC8624646C0B5ADBCCF4D2D41263445D46B549EF06E6E0798AC25C592F963CF1B89D8073C52BE00797399A5CAB05A4337D97FB2CF757CE815AC8AD974BC45E3FBF989FDB9CA3BBAC18083F2304A4293004B8D39F7321D386F7CD30957741841CA9EA0359E12B08E1569B06E9D6E803812AF9A690810ED5F5002A9308E6EE74CC9FE12DDCF001F40D563CD9D4FD7137C8FE8BD8963D9A0A8EA359B90AA3F50F3FCA58F855F6F15FBC66A997C70D0000 , N'6.1.3-40302')
END

IF @CurrentMigration < '201609240309071_AddPostClass'
BEGIN
    CREATE TABLE [dbo].[Posts] (
        [PostId] [int] NOT NULL IDENTITY,
        [Title] [nvarchar](200),
        [Content] [nvarchar](max),
        [BlogId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Posts] PRIMARY KEY ([PostId])
    )
    CREATE INDEX [IX_BlogId] ON [dbo].[Posts]([BlogId])
    CREATE UNIQUE INDEX [IX_Title] ON [dbo].[Posts]([Title])
    ALTER TABLE [dbo].[Blogs] ADD [Rating] [int] NOT NULL DEFAULT 3
    ALTER TABLE [dbo].[Posts] ADD CONSTRAINT [FK_dbo.Posts_dbo.Blogs_BlogId] FOREIGN KEY ([BlogId]) REFERENCES [dbo].[Blogs] ([BlogId]) ON DELETE CASCADE
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201609240309071_AddPostClass', N'MigrationsDemo.BlogContext',  0x1F8B0800000000000400D559DB6EE336107D2FD07F20F4D416592B9797D6B077917592C2E83A0EA264D1B78096C60E518A54452AB051F4CBFAD04FEA2F74A89B254AF22DEB4D8B05820D397338333C339C51FEF9EBEFC18765C8C90BC48A493174CE7AA70E01E1CB8089C5D049F4FCDD8FCE87F7DF7E33B80EC225F95CC85D1839D4146AE83C6B1DF55D57F9CF1052D50B991F4B25E7BAE7CBD0A58174CF4F4F7F72CFCE5C400807B10819DC2742B310D25FF0D791143E443AA17C2203E02A5FC71D2F4525B7340415511F86CE842D62AAD10A7505A174C8256714ADF080CF1D4285903ADDED3F2AF0742CC5C28B7081F28755042837A75C416E7B7F2DBEAB1BA7E7C60D77AD5840F989D232DC13F0EC228F8B6BAB1F145DA78C1B46EE1A23AC57C6EB347A43E723970B87D807F5473C364276607B46FC84D4174F4A062051CCBF13324AB84E62180A48744CF909B94B669CF9BFC0EA41FE06622812CEAB76A165B8575BC0A5BB584610EBD53DCC2BD68E0387B8755DD7562E552DBDCCA7B1D017E70EB94523E88C4379FD15FF3D2D63F81904A09F10DC51AD21C6DB1B079006B06181759EF9599C867CC3B471C8842E3F8158E8670C2A5D3AE4862D212856720B1E05C32C43251D27B0ED90C7981FFD8C7B0C8701DE1C380BE396BEB0451A470BED4E2AAD1C720F3C63CF338BB21CED999DA78C8B37B10CEF25CFC5D3C5A7071A2F40A319D2DEF16412FB960903774DF38DE437307B90DF88BF21F9CDF18790BFD0FB5AE47F609A6F623FD6A62FC04C7C1D34DA73F40CD8AD74EC9A0119C5F74F8082E6CD042852639704B8544AFA2C3DBAC28DECD8BA03D722209D3664012FACC69823E1598414C72387CE0F8D68B4819519BD06CBBCAF839D39765E4CC51570D0402EFDEC451D51E5D3A079071883A0BE82A904B1E130E5C81E85C9C9846EE61D133E8B28EF32D952D8E39D324695F0F6CE1544204C8675C5FD75E796F05690B6C564E05648D32CA6260B5103E28A0169662EDB0A2B765F796D5579F2D94431981EE80A1ABE176B32D798D260595D397F6C1ACA19672DE58A9375843C272BFB8D84B563BD29774A234BFB1A57B5295B2AEA796C6CD2D71D69A909E58DADDB6937EBA78BBEDBED68BC07131A4558642B8D78BE42BCAC0B1FBDF3F66F51C30CC3F5554BA75A5A5B9E846F135D80B56B9E83006E58ACF415D574464D4D1E056143ACCACF0EFA14275529D8BCA3825485B4F97FA6D1D231B7E46EAE7783CE8426E9D337D7BADEA65A3AFB504EE38E476A2479128ACDB5A01B25EB5AAB18D9CAEE08694B5A05481776D72FDACD2A44B1D64419B856141B55AF714F8D27A27EE93B51224BDC575022AD40FB53A25DAD2B9445D7570D657B07B90925EFE5AA20F9D2EE1865A75645291777C7D98FE4472547A398DA22E5E96551B58AE7202F64DB3F6D342A5B26E2100CCF0B0B4C55F3564A43D833023DEF773EE22C0D6D2130A182CD41E96CFCC0FEFBECDCFA42F2DFF95AE12A15F01D3E59BCD9C7036622BB7542DA36206CF85E205E68EC3FD3F8BB902EBFAF22EDF94DE05538F5B93FF579A34BFB8DDC6F36FC1EE5F26AF36E11F5E6C4BBDF0558E3EDAB2EB385C08DD67C8CC3C172E8FC91AAF4C9F8D7A74CEB844C632C217D724AFE3C9003874C9D59D7FD3587C37ADB7DC0947BD074D9D11D1E6DA2FC7F4C91CD667EFB9CD8392666CFE5D00966126F35636FFBF0D43641760E906DB0AD23DD9166CBAACFEB8961DB38D998408F3341369B1BE448E5AF3BC84DC5166B08F3B71E017E8D1DA5CC58CC654152CBA242C42A7813D03440EA5CC69ACDA9AF71DB07A5D217ED33E5098A5C873308C6629AE828D1E83284335EFBB269C8BEE9FC744CAEDB3C98466993FF255C403319BA0053F131613C28EDBE69A9BB1D10268BF267CEDCA536CFDD625522DD4AB123501EBE32F91F208C3882A9A9F0E80B1C62DBA3824FB0A0FEAAE851BB41B65F443DEC832B4671DC0A558EB1D6C75F91C341B87CFF2FAB15BCB0E41C0000 , N'6.1.3-40302')
END

IF @CurrentMigration < '201609240320511_AddPostAbstract'
BEGIN
    ALTER TABLE [dbo].[Posts] ADD [Abstract] [nvarchar](max)
    Update dbo.Posts Set Abstract = Left(Content,100) Where Abstract IS Null
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201609240320511_AddPostAbstract', N'MigrationsDemo.BlogContext',  0x1F8B0800000000000400D559DB6EE336107D2FD07F20F4D416592B9797D6B077917592C2E83A0EA264D1B78096C60E518A54452AB051F4CBFAD04FEA2F74A89B254AF22DEB4D8B05820DC5391C0ECF0CE730FFFCF5F7E0C332E4E40562C5A4183A67BD538780F065C0C462E8247AFEEE47E7C3FB6FBF195C07E1927C2EE65D98796829D4D079D63AEABBAEF29F21A4AA17323F964ACE75CF97A14B03E99E9F9EFEE49E9DB980100E621132B84F846621A4BFE0AF23297C887442F94406C0553E8E5FBC1495DCD21054447D183A13B688A9462FD41584D221979C51F4C2033E77081542EAF46BFF5181A76329165E8403943FAC22C07973CA15E4BEF7D7D377DDC6E9B9D986BB362CA0FC446919EE09787691C7C5B5CD0F8AAE53C60D23778D11D62BB3EB347A43E723970B87D80BF5473C3693ECC0F6CCF413521F3C2919804431FF4EC828E13A89612820D131E527E42E9971E6FF02AB07F91B88A14838AFFA859EE1B7DA000EDDC5328258AFEE615EF1761C38C4ADDBBAB671696AD9657B1A0B7D71EE905B7482CE3894C75FD9BFA7650C3F8300DC270477546B88F1F4C601A4016C7860AD677E16AB21DF306D1C32A1CB4F2016FA19834A970EB9614B088A91DC8347C130CBD048C7096C5BE431E6475FE31EC361803707CEC2B8A52F6C91C6D142BB934A2B87DC03CFD8F3CCA22C477BE6CB53C6C59B5886F792E7D3D3C1A7071A2F40A31BD2FEE2C924F62D1706EE9AE61BC96F60F620BF99FE86E437CB1F42FEC2EE6B91FF8169BE89FD589BBE0033F176D0E8CFD133E072A6F014FDE32FB45B8DDA35D5B25CDA3FD38A7C6A665A9183BB64DAA552D267E9D2151266CBD637702D02D2E94316F0C26B8C3966168B309770C9A1F343231A6D6065E9588365BBAF839D3976024EC51570D0402EFDECEA1E51E5D3A079061883A03E82390BB14916CA91A6863F4CE8668233E1B388F22E972D833D2E44E354096F7FB982088449E5AEB8BF6EDD12DE0AD2B6980CDC0A699A55DBA43B5A405C71202D01CBB60A8E6D5E5EC4559E7C36510CA607BA828617D39ACC35A634585637CE6FB58671C659CBB8B2C93A429E9395EF8D84B563BD29774A274BFF1A47B5295B2AE6796C6CD2D737D25213CA135BF7ED6ED6B8170DBEDBD1E10F26348AB0C8563AFE7C847859BB3F7AE7EDDF0B871986EBAB9696B8F4B65C092F41BA00EBABB97702B861B1D25754D31935357914848D69557E76D0A758A94AC1E61915A42A669BFF67162DAD794BEEE67637B899D0247D7AB95BC7DB344B4516E534EEB8A4469227A1D85C0BBA51B2F6B88A918DEC8E90F6BE5580746077FBA2AFAD4214634D94816B45B151F51AE7D4B822EA87BE1325B2C47D0525D20AB43F25DACDBA4259B497D550B6B7AA9B50F2A6B10A920FED8E51B68455947270779C75CB57055A8FEE8EB45FBA1C95668DB26C4F29572FCBB35586077949DCFE1AD3A891D9148760785E5860EAA3B7521AC29E99D0F37EE723CED2432A264CA86073503A534C2819CECEAD479DFFCE038BAB54C077786579B3F70E6622BB55D46D931A1B9E38C40B8DFD671A7F17D2E5F755A43D9F315E85537FAA48F7BC714BFBBD12BC995E3FCAE1D5247A11F5A648DFEF002C45FEAAC3B455F7ABC05AB2A1A118C6A8599643E78FD4A44FC6BF3E655627641A633DEA9353F2E781843A440C6762E06B6AD6BA1A38407C1F247A3B9AD6A309DDFF87B86D6A8CEDF2B553BD6677EFD00966124F35636FBBA66B13B69DBAB60DB655691E49F256F7BC1632DB546E43181F47D8363B25E448E5AF5BC84DC5166B08F3B72E017E8D1DE59CB198CB82A49647C514ABE04D40D300A973196B36C72A8A9F7D502ABD1E3F539EE094EB7006C1584C131D251AB70CE18CD75E760DD937AD9FAAF7BACF8369946A8F2FB1057493E116602A3E268C07A5DF372D75B703C264517E679AB3D4E6EE5CAC4AA45B297604CAC35726FF038411473035151E7D81437C7B54F00916D45F150D6F37C8F683A8877D70C528AAC050E5186B7BFC15391C84CBF7FF0299A193CCE41D0000 , N'6.1.3-40302')
END

